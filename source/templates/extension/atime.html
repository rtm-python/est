{%- macro show(index, task, answer) -%}
	<div class="d-flex">
		<div width="50%" padding-top="50%" style="margin: auto;">
			<canvas id="nowClock{{ index }}" width="100%" height="100%"></canvas>
		</div>
		{%- if task[1] -%}
			<div width="50%" padding-top="50%" style="margin: auto;">
				<canvas id="nextClock{{ index }}" width="100%" height="100%"></canvas>
			</div>
		{%- endif -%}
	</div>
	<script type="text/javascript">
		$(window).on('load', function() {
			var nowCanvas = $("#nowClock{{ index }}")[0];
			var nowCtx = nowCanvas.getContext("2d");
			var radius = nowCanvas.height / 2;
			nowCtx.translate(radius, radius);
			var nextCanvas = $("#nextClock{{ index }}")[0];
			if (nextCanvas) {
				var nextCtx = nextCanvas.getContext("2d");
				nextCtx.translate(radius, radius);
			}
			radius = radius * 0.95;
			drawClock(nowCtx, radius, "{{ task[0][0] }}", "{{ task[0][1] }}");
			if (nextCanvas) {
				drawClock(nextCtx, radius, "{{ task[1][0] }}", "{{ task[1][1] }}");
			}
		})

		function drawClock(ctx, radius, hours, minutes) {
			if (hours >= 6 && hours < 18) {
				var bg_color = "aliceblue";
				var fg_color = "darkslateblue";
			} else {
				var bg_color = "darkslateblue";
				var fg_color = "aliceblue";
			}
			drawFace(ctx, radius, bg_color, fg_color);
			drawNumbers(ctx, radius, fg_color);
			drawTime(ctx, radius, hours, minutes, fg_color);
		}

		function drawFace(ctx, radius, bg_color, fg_color) {
			var grad;
			ctx.beginPath();
			ctx.arc(0, 0, radius, 0, 2 * Math.PI);
			ctx.fillStyle = bg_color;
			ctx.fill();
			grad = ctx.createRadialGradient(0, 0 ,radius * 0.95, 0, 0, radius * 1.05);
			grad.addColorStop(0, fg_color);
			grad.addColorStop(0.5, bg_color);
			grad.addColorStop(1, fg_color);
			ctx.strokeStyle = grad;
			ctx.lineWidth = radius*0.1;
			ctx.stroke();
			ctx.beginPath();
			ctx.arc(0, 0, radius * 0.06, 0, 2 * Math.PI);
			ctx.fillStyle = fg_color;
			ctx.fill();
		}

		function drawNumbers(ctx, radius, fg_color) {
			var ang;
			var num;
			ctx.font = radius * 0.20 + "px arial";
			ctx.textBaseline = "middle";
			ctx.textAlign = "center";
			ctx.fillStyle = fg_color;
			for(num = 1; num < 13; num++){
				ang = num * Math.PI / 6;
				ctx.rotate(ang);
				ctx.translate(0, -radius * 0.80);
				ctx.rotate(-ang);
				ctx.fillText(num.toString(), 0, 0);
				ctx.rotate(ang);
				ctx.translate(0, radius * 0.80);
				ctx.rotate(-ang);
			}
		}

		function drawTime(ctx, radius, hours, minutes, fg_color){
			//hour
			hours = hours%12;
			hours = (hours*Math.PI/6)+(minutes*Math.PI/(6*60));
			drawHand(ctx, hours, radius*0.48, radius*0.07, fg_color);
			//minute
			minutes = (minutes*Math.PI/30);
			drawHand(ctx, minutes, radius*0.68, radius*0.06, fg_color);
		}

		function drawHand(ctx, pos, length, width, fg_color) {
			ctx.beginPath();
			ctx.lineWidth = width;
			ctx.lineCap = "round";
			ctx.fillStyle = fg_color;
			ctx.moveTo(0,0);
			ctx.rotate(pos);
			ctx.lineTo(0, -length);
			ctx.stroke();
			ctx.rotate(-pos);
		}
	</script>
	<div class="d-flex col-12 mt-2 mb-0" style="margin: 0 auto; width: min-content;">
		{%- if answer -%}
			<h3 class="m-0 p-0">{{ answer }}</h3>
		{%- else -%}
			<select autofocus required name="hours" class="{%- if player.answer.errors -%}{{ ' is-invalid' }}{%- endif -%}">
				{%- for hour in range(24) -%}
					<option value="{{ '%02d' % hour }}">{{ '%02d' % hour }}</option>
				{%- endfor -%}
			</select>
			<div style="margin: auto 5px;">:</div>
			<select autofocus required name="minutes" class="{%- if player.answer.errors -%}{{ ' is-invalid' }}{%- endif -%}">
				{%- for minute in range(60) -%}
					<option value="{{ '%02d' % minute }}">{{ '%02d' % minute }}</option>
				{%- endfor -%}
			</select>
		{%- endif -%}
	</div>
	{%- if player -%}
		{%- for error in player.answer.errors -%}
			<div class="invalid-feedback">
				{{ __(error) }}
			</div>
		{%- endfor -%}
	{%- endif -}
{%- endmacro -%}
