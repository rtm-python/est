{%- extends "layout.html" -%}
{% set title -%}{{ __('Examination') }}{%- endset %}
{%- block body_content -%}
	<h2 class="mt-3">{{ __('Examination') }}</h2>
	<div class="mt-2 d-flex w-100 justify-content-between">
		<h4 class="mb-2">{{ examination.name }}</h4>
		<small>{{  examination.plugin }}</small>
	</div>
	<p class="lb-1">{{  examination.description }}</p>
	<div class="progress" style="height: 3px;">
		<div class="progress-bar" role="progressbar" style="width: {{  examination.score }}%" area-valuenow="{{  examination.score }}" area-valuemin="0" area-valuemax="100"></div>
	</div>
	<small class="mt-2 timestamp d-flex justify-content-end">{{  examination.modified_utc }}</small>
	<form actions="" method="post" class="col-12 col-md-8 offset-md-2 mt-3">
		{{ starter.csrf_token }}
		<div class="form-row">
			<div class="col-12 col-md-3 mb-2">
				<small>{{ __('Repeat') }}</small>
				<select class="custom-select{%- if starter.repeat.errors -%}{{ ' is-invalid' }}{%- endif -%}" name="repeat">
					<option {%- if starter.repeat.data == '' -%}selected{%- endif -%}>{{ __('Select Repeat...') }}</option>
					{%- for choice in starter.repeat.choices -%}
						<option value="{{ choice[0] }}" {%- if starter.repeat.data == choice[0] -%}selected{%- endif -%}>{{ choice[1] }}</option>
					{%- endfor -%}
				</select>
				{%- for error in starter.repeat.errors -%}
					<div class="invalid-feedback">
						{{ __(error) }}
					</div>
				{%- endfor -%}
			</div>
			<div class="col-12 col-md-3 mb-2">
				<small>{{ __('Performance') }}</small>
				<select class="custom-select{%- if starter.performance.errors -%}{{ ' is-invalid' }}{%- endif -%}" name="performance">
					<option {%- if starter.performance.data == '' -%}selected{%- endif -%}>{{ __('Select Performance...') }}</option>
					{%- for choice in starter.performance.choices -%}
						<option value="{{ choice[0] }}" {%- if starter.performance.data == choice[0] -%}selected{%- endif -%}>{{ choice[1] }}</option>
					{%- endfor -%}
				</select>
				{%- for error in starter.performance.errors -%}
					<div class="invalid-feedback">
						{{ __(error) }}
					</div>
				{%- endfor -%}
			</div>
			<div class="d-flex align-items-end col-12 col-md-3 my-2">
				<button type="submit" class="btn btn-block btn-outline-dark">{{ __('Start...') }}</button>
			</div>
			<div class="d-flex align-items-end col-12 col-md-3 mb-2">
				<a href="{{ url_for('examination.get_examination_catalog') }}" class="btn btn-block btn-outline-dark">{{ __('Catalog...') }}</a>
			</div>
		</div>
	</form>
	{%- if recent|length > 0 -%}
		<div class="row mt-3 mb-2">
			<small class="col-12">{{ __('Recents...') }}</small>
		</div>
		<div class="row mb-1">
			{%- for item in recent -%}
				<div class="mb-2 col-12 col-sm-6 col-md-4 col-lg-3">
					<div class="card">
						<div class="card-body">
							<div class="d-flex w-100 justify-content-between">
								<h5 class="card-title">{{ item.name }}</h5>
								<small>{{  item.plugin }}</small>
							</div>
							<div class="card-text">
								<small>{{ item.answered_count }}/{{ item.repeat }}</small>
								<div class="progress" style="height: 3px;">
									<div class="progress-bar" role="progressbar" style="width: {{  item.progress }}%" area-valuenow="{{  item.progress }}" area-valuemin="0" area-valuemax="100"></div>
								</div>
								<small class="mt-2 timestamp d-flex justify-content-end">{{  item.modified_utc }}</small>
							</div>
							{%- if item.repeat > item.answered_count -%}
								<div class="col-8 offset-2 mt-2">
									<a href="{{ url_for('examination.follow_process', uid=item.uid) }}" class="btn btn-sm btn-block btn-outline-dark"">{{ __('Continue...') }}</a>
								</div>
							{%- endif -%}
						</div>
					</div>
				</div>
			{%- endfor -%}
		</div>
	{%- endif -%}
{%- endblock -%}
{%- block body_script -%}
	<script type="text/javascript">
		var elements = $(".timestamp");
		var user_tz = moment.tz.guess();

		for (var i = 0; i < elements.length; i++) {
			elements[i].textContent = moment(elements[i].textContent + "+00:00").tz(user_tz).format('HH:mm:ss DD MMMM YYYY, dddd');
		}
	</script>
{%- endblock -%}
